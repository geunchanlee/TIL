# TIL_26/01/27 - 클라이언트에서 데이터 처리해 넘기기

프로필 기능에 firebase를 연동하던 중 프로필 이미지를 어떻게 넣을 지 고민해봤다.

파이어스토어는 각 문서의 용량이 문서당 1MB로 제한되어있다. 아마 일반적으로 이미지파일을 데이터베이스에 바로 넣는 경우는 거의 없을 것이기 때문에 큰 문제가 아닐 수 있지만 우리는 지금 시간이 모자라서 다른 기능을 찾아보기보단 파이어스토어에 넣어야 했다.

파이어스토어 총 용량도 무료계정의 경우 1GB로 정해져있기 때문에 그냥 이미지를 넣으면 용량이 모자를 것 같았다.

이를 막기 위해 이미지를 클라이언트에서 DB로 보내기 전에 미리 압축하게 하는 기능을 만들었다.

## 이미지 압축 유틸

```jsx
//image-utils.js

export function compressImage(file, maxWidth = 300, quality = 0.7) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);

        reader.onload = (event) => {
            const img = new Image();
            img.src = event.target.result;

            img.onload = () => {
                const canvas = document.createElement('canvas');
                
                // 원본 비율 유지하며 크기 계산
                const scale = maxWidth / img.width;
                canvas.width = maxWidth;
                canvas.height = img.height * scale;

                const ctx = canvas.getContext('2d');
                // 이미지 부드럽게 그리기 설정
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                // JPEG 형식으로 압축 (용량 최적화)
                const base64 = canvas.toDataURL('image/jpeg', quality);
                resolve(base64);
            };

            img.onerror = (error) => reject(error);
        };

        reader.onerror = (error) => reject(error);
    });
}
```

코드는 ai도움으로 만들어서 내용이 중요하진 않고, 저장 데이터의 용량 문제를 클라이언트 측에서 해결하는 방법을 알게 된 걸 기억해야겠다.

클라이언트 사이드에서 데이터를 미리 줄여서(줄여도 되는 프로필 이미지니까) 데이터베이스로 전송하면 나의 경우 firestore 사용량을 줄일 수 있었고, 아마 회사라면 관련된 비용을 줄일 수 있을 것 같다. -> 이렇게 생각하니까 중요한 일 같다. 🤭

이 기능을 만들고나서 예전에 JSP 수업에서 로그인 시 정규표현식을 사용한 검사 내용을 배우면서 프론트엔드에서 간단하게 처리할 수 있는 요소들은 처리해서 백엔드로 넘겨주면 서버측의 부담을 줄일 수 있기 때문에 할 수 있는 것들은 미리 처리해주는게 좋다고 배웠던 기억이 났다. 

- 실제 프로젝트에서도 이렇게 프론트엔드단에서 최적화하는 경우는 어떤 것이 있는지 알아보기!

<br/>

## 기억하기 / 찾아보기

1. 프론트엔드에서 백엔드로 데이터를 보낼 때 무작정 받아서 다 보내지 말고 최적화 할 수 있는 부분은 최적화해서 보내주자.

2. 실제로 업무에서 프론트엔드에서 처리해 넘겨주는 경우는 주로 어떤 일에서 일어나는지 찾아보기